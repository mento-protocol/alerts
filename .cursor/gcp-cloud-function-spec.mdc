# Google Cloud Function Specification: QuickNode to Discord Router

## Function Overview

This Cloud Function serves as middleware between QuickNode webhooks and Discord, processing blockchain events and routing them to appropriate Discord channels based on event type and multisig source.

## Technical Specifications

### Runtime Configuration

- **Runtime**: Node.js 18
- **Memory**: 256MB
- **Timeout**: 60 seconds
- **Max Instances**: 10
- **Min Instances**: 0 (cold start acceptable)
- **Trigger**: HTTP/HTTPS

### Event Data Structure from QuickNode

```json
{
  "id": "webhook-id",
  "created_at": "2024-01-01T00:00:00Z",
  "delivery_attempt": 1,
  "block": {
    "hash": "0x...",
    "number": 12345678,
    "timestamp": 1234567890
  },
  "logs": [
    {
      "address": "0x655133d8E90F8190ed5c1F0f3710F602800C0150",
      "topics": [
        "0x9465fa0c962cc76958e6373a993326400c1c94f8be2fe3a952adfa7f60b2ea26",
        "0x0000000000000000000000001234567890abcdef1234567890abcdef123456"
      ],
      "data": "0x...",
      "blockNumber": "0xbc4567",
      "transactionHash": "0xabc...",
      "transactionIndex": "0x1",
      "blockHash": "0xdef...",
      "logIndex": "0x2",
      "removed": false
    }
  ]
}
```

### Core Function Implementation

The function processes webhook events from QuickNode, identifies Safe contract events, and routes them to Discord channels based on event type (security alerts vs operational events).

### Error Handling Strategy

1. **Webhook Signature Validation** - Return 401 if signature invalid
2. **Event Processing Failures** - Continue processing other events
3. **Discord Delivery Failures** - Implement exponential backoff
4. **Rate Limiting** - Respect Discord rate limits

### Security Considerations

1. **Input Validation** - Validate all webhook fields
2. **Secret Management** - Use GCP Secret Manager
3. **Access Control** - Function requires authentication
